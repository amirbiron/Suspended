# 🔧 מדריך ניהול משתני סביבה (Environment Variables)

## תיאור
הבוט מאפשר כעת עדכון משתני סביבה של בוטים/שירותים אחרים דרך ממשק טלגרם.
זוהי פעולה רגישה המיועדת למנהל המערכת בלבד.

## פקודות זמינות

### 📋 `/env_list [service_id]`
הצגת רשימת כל משתני הסביבה של שירות.

**דוגמה:**
```
/env_list srv-d26cf32dbo4c73f27de0
```

**פלט לדוגמה:**
```
📝 משתני סביבה של My Bot Service

🆔 Service ID: srv-d26cf32dbo4c73f27de0
📊 סה"כ משתנים: 5

🔐 DATABASE_URL: [מוסתר/סודי]
📌 DEBUG: true
📌 NODE_ENV: production
📌 PORT: 10000
🔐 SECRET_KEY: [מוסתר/סודי]
```

**הערות:**
- משתנים סודיים (secret) לא מוצגים מטעמי אבטחה
- Render API לא מחזיר ערכים של משתנים שמוגדרים כ-secret

---

### ✏️ `/env_set [service_id] [key] [value]`
עדכון או הוספת משתנה סביבה לשירות.

**דוגמאות:**
```bash
# עדכון משתנה קיים
/env_set srv-123456 API_KEY new_api_key_value_here

# הוספת משתנה חדש
/env_set srv-123456 DEBUG true

# ערך עם רווחים
/env_set srv-123456 WELCOME_MESSAGE Hello World Welcome
```

**תהליך:**
1. הבוט מציג הודעת אישור עם פרטי השינוי
2. לחיצה על "✅ כן, עדכן" מבצעת את הפעולה
3. לחיצה על "❌ בטל" מבטלת את הפעולה

**⚠️ אזהרות:**
- שינוי משתנה סביבה עשוי לגרום לדיפלוי מחדש של השירות
- הפעולה היא מיידית ואוטומטית
- וודא שהערך תקין לפני האישור

---

### 🗑️ `/env_delete [service_id] [key]`
מחיקת משתנה סביבה משירות.

**דוגמה:**
```
/env_delete srv-123456 OLD_API_KEY
```

**תהליך:**
1. הבוט מציג הודעת אישור עם פרטי המחיקה
2. לחיצה על "✅ כן, מחק" מבצעת את הפעולה
3. לחיצה על "❌ בטל" מבטלת את הפעולה

**⚠️ אזהרות:**
- פעולה זו בלתי הפיכה!
- מחיקת משתנה חיוני עלולה לשבור את השירות
- שינוי משתנה סביבה עשוי לגרום לדיפלוי מחדש של השירות

---

## הרשאות
- **כל הפקודות דורשות הרשאות אדמין**
- רק המשתמש שמוגדר ב-`ADMIN_CHAT_ID` יכול להשתמש בפקודות אלו
- משתמשים אחרים יקבלו הודעת שגיאה: "❌ פקודה זו זמינה רק למנהל המערכת"

## תהליך טכני

### בקשות API
הבוט משתמש ב-Render API:
- `GET /services/{id}/env-vars` - קבלת משתנים
- `PATCH /services/{id}/env-vars/{key}` - עדכון משתנה קיים
- `POST /services/{id}/env-vars` - יצירת משתנה חדש
- `DELETE /services/{id}/env-vars/{key}` - מחיקת משתנה

### תגובות אוטומטיות
לאחר עדכון/מחיקה מוצלחים:
```
✅ עדכון מוצלח!

🤖 שירות: My Bot Service
🆔 ID: srv-123456
🔑 משתנה: API_KEY
✨ Environment variable 'API_KEY' updated successfully

⚠️ השירות עשוי לעבור דיפלוי מחדש כעת.
💡 הקש /env_list srv-123456 לראות את כל המשתנים
```

## טיפים ושימושים

### שימושים נפוצים:
1. **עדכון API Keys** - החלפת מפתחות API שפג תוקפם
2. **שינוי הגדרות DEBUG** - הפעלה/כיבוי מצב דיבאג
3. **עדכון URLs** - שינוי כתובות של databases, APIs וכו'
4. **ניהול secrets** - החלפת סיסמאות וטוקנים

### דוגמאות מעשיות:

```bash
# החלפת מפתח API שפג תוקפו
/env_set srv-123456 OPENAI_API_KEY sk-new-key-here

# הפעלת מצב debug לזיהוי תקלה
/env_set srv-123456 DEBUG true

# עדכון כתובת database
/env_set srv-123456 DATABASE_URL postgresql://new-url

# מחיקת משתנה ישן שלא בשימוש
/env_delete srv-123456 DEPRECATED_VAR
```

### אבטחה:
- שמור על סודיות מפתחות ה-API שלך
- אל תשתף screenshots של רשימת המשתנים
- השתמש במשתנים סודיים (secrets) ב-Render לערכים רגישים
- וודא שאתה בחדר פרטי לפני ביצוע פעולות

## פתרון בעיות

### "❌ השירות לא נמצא ב-Render או שה-ID שגוי"
- בדוק שה-service ID נכון
- וודא שיש לך הרשאות ל-Render API
- נסה `/status` לראות רשימת שירותים זמינים

### "❌ כשלון בעדכון"
- ייתכן שאין הרשאות מספיקות ב-Render API Key
- בדוק שהשירות לא נמחק
- נסה שוב מאוחר יותר

### "❌ הערך לא נמצא בזיכרון, נסה שוב"
- הפעולה לקחה יותר מדי זמן
- הקש את הפקודה מחדש

## קוד מקור

הפונקציונליות ממומשת ב:
- **render_api.py** - פונקציות API: `get_env_vars()`, `update_env_var()`, `delete_env_var()`
- **main.py** - פקודות טלגרם: `env_list_command()`, `env_set_command()`, `env_delete_command()`

## תמיכה נוספת
- הקש `/help` לעזרה כללית
- הקש `/status` לראות רשימת שירותים
- צור איתי קשר אם יש בעיות
