# 📋 מדריך ניטור לוגים - Log Monitoring Guide

## 🎯 מה זה?

תכונה חדשה שמאפשרת:
1. **צפייה בלוגים** ישירות מהבוט בטלגרם
2. **ניטור אוטומטי** של לוגים וזיהוי שגיאות בזמן אמת
3. **התראות מיידיות** כשנמצאות שגיאות או שגיאות קריטיות

---

## 🚀 התחלה מהירה

### 1. צפייה בלוגים

```
/logs srv-your-service-id [lines] [minutes]
```

**אפשרויות:**
```bash
/logs srv-123456            # 100 שורות אחרונות
/logs srv-123456 50         # 50 שורות אחרונות
/logs srv-123456 200        # 200 שורות אחרונות (מקסימום)
/logs srv-123456 100 5      # 100 שורות מה-5 דקות האחרונות
/logs srv-123456 50 10      # 50 שורות מה-10 דקות האחרונות
/logs srv-123456 200 30     # 200 שורות מה-30 דקות האחרונות
```

**הבנת הפרמטרים:**
- `lines` - **מספר השורות** להציג (100 האחרונות)
- `minutes` - **טווח זמן** (אופציונלי) - מביא לוגים רק מהזמן הזה
- **ללא `minutes`**: מציג את ה-N שורות האחרונות מכל הזמן
- **עם `minutes`**: מציג את ה-N שורות האחרונות מטווח הזמן

**דוגמה:**
```
📋 לוגים של My Bot

🕐 טווח: 14:25:30 - 14:30:45
📊 סה"כ: 100 שורות (מה-5 דקות האחרונות)
```

הבוט יציג:
- 🔴 **STDERR** - שגיאות וחריגות
- 📝 **STDOUT** - פלט רגיל
- 🕐 **טווח זמן** - מתי עד מתי

---

### 2. הפעלת ניטור אוטומטי

```
/logs_monitor srv-your-service-id
```

**עם סף שגיאות מותאם:**
```bash
/logs_monitor srv-123456 3    # התראה אחרי 3 שגיאות
/logs_monitor srv-123456 10   # התראה אחרי 10 שגיאות
```

**ברירת מחדל:** 5 שגיאות

---

### 3. ניהול עם כפתורים

```
/logs_manage
```

ממשק ידידותי עם:
- 🔍 רשימת כל השירותים
- 💤/🔍 סטטוס ניטור לכל שירות
- 🔥 אינדיקציה לשגיאות שזוהו
- הפעלה/כיבוי בלחיצה

---

## ⚙️ זיהוי שגיאות

### Patterns שמזוהים:

**שגיאות רגילות:**
- `error`, `exception`, `failed`, `crash`
- קודי HTTP 4xx, 5xx
- `uncaught`, `unhandled`
- `traceback`, `stack trace`

**שגיאות קריטיות:** 🔥
- `fatal`, `segmentation fault`
- `out of memory`, `disk full`
- `database down/unreachable`
- `connection refused`, `timeout`

---

## 📊 התראות

### התראה רגילה (⚠️):
```
⚠️ התראת שגיאה רגילה

🤖 שירות: My Bot
🆔 ID: srv-123456
📊 זוהו 5 שגיאות

שגיאות אחרונות:
1. Error: Connection timeout
2. Error: Failed to connect to database
3. Exception: ValueError in process_data()

💡 הקש /logs srv-123456 לצפייה מלאה
```

### התראה קריטית (🔥):
```
🔥 התראת שגיאה קריטית

🤖 שירות: My Bot
🆔 ID: srv-123456
📊 זוהו 2 שגיאות

שגיאות אחרונות:
1. FATAL: Out of memory
2. Database connection refused

💡 הקש /logs srv-123456 לצפייה מלאה
```

---

## 🎛️ פקודות מלאות

| פקודה | תיאור | דוגמה |
|-------|--------|--------|
| `/logs` | צפייה בלוגים | `/logs srv-123 100` |
| `/logs_monitor` | הפעלת ניטור | `/logs_monitor srv-123 5` |
| `/logs_unmonitor` | כיבוי ניטור | `/logs_unmonitor srv-123` |
| `/logs_manage` | ניהול עם כפתורים | `/logs_manage` |

---

## 🔧 הגדרות מתקדמות

### שינוי סף שגיאות

**נמוך (רגיש יותר):**
```bash
/logs_monitor srv-123456 1    # התראה על כל שגיאה
```

**גבוה (פחות רגיש):**
```bash
/logs_monitor srv-123456 20   # התראה רק אחרי הרבה שגיאות
```

**המלצות:**
- **Production**: 3-5 שגיאות
- **Development**: 10-20 שגיאות
- **Testing**: 20+ או כיבוי ניטור

---

## 📈 מעקב וסטטיסטיקות

בממשק `/logs_manage` תראה:

```
🤖 My Bot
🆔 srv-123456

✅ ניטור לוגים פעיל
🎯 סף שגיאות: 5
🔥 שגיאות אחרונות: 3
📊 סה"כ שגיאות: 127
```

---

## 💡 טיפים וטריקים

### 1. זיהוי בעיות בפריסה
```bash
# לפני פריסה
/logs_monitor srv-123456 3

# אחרי פריסה - בדוק לוגים
/logs srv-123456 50
```

### 2. Debug של בעיות
```bash
# בדוק שגיאות אחרונות
/logs srv-123456 20

# הפעל ניטור רגיש
/logs_monitor srv-123456 1
```

### 3. חיסכון בהתראות
```bash
# בסביבת dev - העלה סף
/logs_monitor srv-dev-123 20

# בסביבת prod - הנמך סף  
/logs_monitor srv-prod-456 3
```

---

## 🔍 זיהוי False Positives

המערכת מתעלמת מ:
- `error: 0` (לא באמת שגיאה)
- `no error`
- `errorless`

אם יש לך false positives נוספים, ניתן להוסיף ב-`log_monitor.py`:
```python
self.ignore_patterns = [
    r'(?i)error:\s*0',
    r'(?i)no error',
    r'(?i)your custom pattern',
]
```

---

## 🔒 אבטחה ופרטיות

- הלוגים מוצגים רק למשתמש האדמין
- הניטור בודק רק את השירותים שהוספת למערכת
- אין שמירה של לוגים - רק זיהוי שגיאות
- כל ההתראות שמורות ב-MongoDB למעקב

---

## 🐛 פתרון בעיות

### לא מקבל התראות?

1. **בדוק שהניטור מופעל:**
   ```
   /logs_manage
   ```
   וודא שיש 🔍 ליד השירות

2. **בדוק את הסף:**
   - אולי הסף גבוה מדי?
   - נסה להוריד ל-1 לבדיקה

3. **בדוק שיש שגיאות:**
   ```
   /logs srv-123456
   ```
   ראה אם יש שגיאות בפועל

### לוגים לא מוצגים?

1. **בדוק את ה-service ID:**
   - השתמש ב-`/status` לקבל את ה-ID הנכון

2. **בדוק את Render API:**
   - וודא שה-API KEY תקף
   - בדוק שהשירות קיים

---

## 📊 דוגמאות שימוש

### תרחיש 1: בדיקת פריסה חדשה
```bash
1. /logs_monitor srv-prod-bot 2
2. # בצע deploy ב-Render
3. # המתן להתראה אם יש שגיאות
4. /logs srv-prod-bot 50  # בדוק לוגים מפורטים
```

### תרחיש 2: ניטור רציף
```bash
1. /logs_monitor srv-prod-bot 5
2. # הבוט ישלח התראה אוטומטית על כל בעיה
3. /logs_manage  # לבדיקה מתי שתרצה
```

### תרחיש 3: חקירת תקלה
```bash
1. /logs srv-prod-bot 200  # צפה בלוגים אחרונים
2. # זהה את הבעיה
3. # תקן את הבעיה
4. /logs srv-prod-bot 50   # אמת שהתיקון עובד
```

---

## 🎓 למידע נוסף

- ראה `/help` לכל הפקודות
- השתמש ב-`/diag` לדיאגנוסטיקה
- בדוק את `log_monitor.py` לקוד המקור

---

## 🚀 תכונות עתידיות (רעיונות)

- [ ] חיפוש בלוגים לפי regex
- [ ] ייצוא לוגים לקובץ
- [ ] גרפים של שגיאות לאורך זמן
- [ ] אינטגרציה עם Sentry
- [ ] התאמה אישית של patterns
- [ ] התראות WhatsApp/Email

---

**נוצר על ידי:** Render Monitor Bot 🤖
**גרסה:** 2.0 (Log Monitoring Edition)
